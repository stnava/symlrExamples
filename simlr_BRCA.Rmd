---
title: "simlr: BRCA Example for data clustering"
output: html_document
---

Demonstrates data-driven supervised clustering and variance explained in 3-view
BRCA/gene-related data.


- Result: SiMLR and RGCCA both are able to perform supervised clustering successfully
as shown by the group separation plot.


```{r}
# https://cran.r-project.org/web/packages/r.jive/vignettes/BRCA_Example.html
set.seed( 808 )
library( r.jive )
library( ANTsR )
if ( ! exists( "energyType" ) ) energyType = 'regression'
data( BRCA_data )
x = Data
for ( k in 1:length( x ) ) x[[k]] = t( x[[k]] )
showPCASyM <- function( x, result, nCluster, names )
{
  library( ggfortify )
  temp = x[[1]] %*% result$v[[1]]
  for ( k in 2:length(x)) temp = cbind( temp, x[[k]] %*% result$v[[k]] )
  scaled_df = scale(temp,T,T)
  mykm = kmeans(scaled_df, nCluster)
  if ( ! missing( names ) ) {
    mydf = data.frame( scaled_df, names=names )
  } else  {
    mydf = data.frame( scaled_df, names = as.character( mykm$cluster ) )
  }
  print( autoplot( prcomp(scaled_df), data = mydf, colour = 'names', label = F ) )
}


if ( energyType == 'regression' ) mixer='ica' else mixer='pca'
initu = initializeSimlr( x, k = 8, uAlgorithm=mixer, jointReduction=T )
regs  = regularizeSimlr( x, fraction = 0.05, sigma = rep(1.5,length(x)) )
for ( j in 1:length(regs)) plot( image(regs[[j]] ))
myseed = as.numeric( Sys.time()  )
connex = list( c(1,2,3), c(1,2,3), c(1,2,3) )
t1 = Sys.time()
sResult = simlr(  x,
    regs,
    positivities = rep("either", length( x ) ),
    iterations = 55,
    initialUMatrix = initu, verbose = 1,
    connectors = connex,
    energyType = energyType,
    mixAlg = mixer,
    expBeta=0.8,
    randomSeed = myseed )
t2 = Sys.time()
svx = predictSimlr( x, sResult )
print( svx[1] )
print((svx$initialErrors/svx$finalErrors)^-1)
plot( ts( sResult$energyPath[-c(1:3),] ) )
print( t2 - t1 )
# if ( ! exists( "Results" ) )
#  Results = jive(Data,method="given",rankJ=2,rankA=c(27,26,25))
showPCASyM( x, sResult, 3 ) #, names=substr(colnames(Data[[2]]),6,7) )
```
